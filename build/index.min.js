!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.JC=t.JC||{})}(this,function(t){"use strict";function i(t){var i=this,e=new JC.Texture(t.texture);this.doc=new JC.Sprite({texture:e}),this.doc.scale=0,t.pivot?(this.doc.pivotX=t.pivot.x,this.doc.pivotY=t.pivot.y):e.loaded?this._center():e.on("load",function(){i._center()})}function e(t){t=t||{},this.radius=t.radius||8,this.color=t.color||"#FFD44F"}function n(t){t=t||{},this.doc=new JC.Graphics(new e({radius:t.radius,color:t.color})),this.doc.scale=0}function o(t){t=t||{},this.stageOpts=a.merge(d,t.stage),this.coinsOpts=t.coins||{},this.blinksOpts=t.blinks||{},this.end=t.end||{},this.duration=t.duration||1e3,this.init()}var s={GLOBAL_WEIGHT:.25,MAX_SLOPE:20,TIMELINE:{stars:[.08,.08,.28,.52,.12],blinks:[.3,.05,.15]}},r=new JC.Point(0,0,10);i.prototype._center=function(){this.doc.pivotX=this.doc.width>>1,this.doc.pivotY=this.doc.height>>1},i.prototype.fly=function(t){var i=t.start,e=t.end,n=t.wait,o=t.duration;if(!this.alive){var r=this,a=new JC.Point(i.x,i.y).add(this.offset),c=new JC.Point(e.x,e.y),l=this._findCP(a,c),d=new JC.BezierCurve([a,l,c]),h=s.TIMELINE.stars;this.alive=!0,this.doc.runners({runners:[{from:{scale:0,x:a.x,y:a.y},to:{scale:1.2,x:a.x,y:a.y},duration:h[0]*o},{to:{scale:1},duration:h[1]*o},{path:d,wait:h[2]*o,duration:h[3]*o,ease:JC.Tween.Back.In},{to:{scale:0},duration:h[4]*o,ease:JC.Tween.Linear.None}],wait:n,onCompelete:function(){r.alive=!1}},!0)}},i.prototype._findCP=function(t,i){var e=(new JC.Point).addVectors(i,t).divideScalar(2),n=(new JC.Point).subVectors(i,t),o=(i.x>t.x?-1:1)*(i.y>t.y?1:-1),a=(new JC.Point).crossVectors(r,n).normalize(),c=n.length(),l=0!==n.y?Math.abs(n.x/n.y):s.MAX_SLOPE,d=Math.sqrt(Math.min(s.MAX_SLOPE,Math.abs(l)))*c,h=a.multiplyScalar(o*d*s.GLOBAL_WEIGHT);return e.add(h)},e.prototype.render=function(t){t.beginPath(),t.fillStyle=this.color,t.arc(0,0,this.radius,0,2*Math.PI,!0),t.closePath(),t.fill()},n.prototype.boom=function(t){var i=t.endBase,e=t.end,n=t.wait,o=t.duration;if(!this.alive){var r=this,a=i.x,c=i.y,l=e.x,d=e.y,h=a+l,u=c+d,p=s.TIMELINE.blinks;this.alive=!0,this.doc.runners({runners:[{from:{x:a,y:c,scale:0},to:{x:h,y:u,scale:1},duration:p[0]*o,ease:JC.Tween.Linear.None},{to:{x:a+1.1*l,y:c+1.1*d},duration:p[1]*o,ease:JC.Tween.Linear.None},{to:{scale:0},duration:p[2]*o,ease:JC.Tween.Linear.None}],wait:n,onCompelete:function(){r.alive=!1}},!0)}};var a={merge:function(t,i){if(!i)return t;for(var e in i)void 0!==i[e]&&(t[e]=i[e]);return t}},c=[{x:-8,y:-8},{x:14,y:-2},{x:-5,y:11}],l={aliveCoins:[],idelCoins:[],aliveBlinks:[],idelBlinks:[],criclrPoint:{}},d={dom:"flycoins-stage",interactive:!1,enableFPS:!1,width:320,height:320};o.prototype.init=function(){this.stage=new JC.Stage(this.stageOpts),this.coins=new JC.Container,this.blinks=new JC.Container,this.stage.adds(this.blinks,this.coins)},o.prototype._getTarget=function(t,i){(i<=0||t<=0)&&console.error("you must insure count and range > 0");var e="cp"+t+"N"+i,n=l.criclrPoint[e]=l.criclrPoint[e]||[];if(n.length===t)return n;for(var o=0;o<t;o++){var s=2*Math.PI*o/t,r=new JC.Point(Math.cos(s)*i,Math.sin(s)*i);n.push(r)}return n},o.prototype._checkAlive=function(t,i){for(var e=t.length-1;e>=0;e--)t[e].alive||i.push(t.splice(e,1)[0])},o.prototype._shipCoins=function(t){var e=this;this._checkAlive(l.aliveCoins,l.idelCoins);var n=t.offsets||c,o=n.length,s=o-l.idelCoins.length;if(s>0)for(var r=0;r<s;r++)l.idelCoins.push(new i(t));var a=l.idelCoins.splice(0,o);return n.forEach(function(t,i){var n=a[i];n.offset=new JC.Point(t.x,t.y),e.coins.adds(n.doc)}),a},o.prototype._emitCoins=function(t,i){var e=i.end,n=i.duration,o=i.start;e=e||this.end,n=n||this.duration;for(var s=t.length-1,r=s;r>=0;r--){var a=t[r];a.fly({start:o,end:e,wait:(s-r)*n*.1,duration:n}),l.aliveCoins.push(a)}},o.prototype.flying=function(t){var i=t.coins,e=t.blinks,n=t.start,o=t.end,s=a.merge(this.coinsOpts,i),r=a.merge(this.blinksOpts,e),c=this._shipCoins(s);this._emitCoins(c,{start:n,end:o}),this._shipAndEmitBlinks(r,o)},o.prototype._shipAndEmitBlinks=function(t,i){var e=t.count,o=t.range,s=t.color,r=t.radius;this._checkAlive(l.aliveBlinks,l.idelBlinks);var a=this._getTarget(e,o),c=e-l.idelBlinks.length;if(c>0)for(var d=0;d<c;d++)l.idelBlinks.push(new n({color:s,radius:r}));var h=l.idelBlinks.splice(0,e);i=i||this.end;for(var u=this.duration,p=h.length,f=0;f<p;f++){var v=h[f],y=a[f];this.blinks.adds(v.doc),v.boom({endBase:i,end:y,wait:u,duration:u}),l.aliveBlinks.push(v)}},o.prototype.start=function(){this.stage.startEngine()},o.prototype.stop=function(){this.stage.stopEngine()},t.CONFIG=s,t.FlyCoins=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
