!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.JC=t.JC||{})}(this,function(t){"use strict";function i(t){var i=this,e=new a.Texture(t.texture);this.doc=new a.Sprite({texture:e}),this.doc.scale=0,t.pivot?(this.doc.pivotX=t.pivot.x,this.doc.pivotY=t.pivot.y):e.loaded?this._center():e.on("load",function(){i._center()})}function e(t){t=t||{},this.radius=t.radius||8,this.color=t.color||"#FFD44F"}function n(t){t=t||{},this.doc=new a.Graphics(new e({radius:t.radius,color:t.color})),this.doc.scale=0}function o(t){t=t||{},this.stageOpts=l.merge(p,t.stage),this.coinsOpts=t.coins||{},this.blinksOpts=t.blinks||{},this.end=t.end||{},this.duration=t.duration||1e3,this.init()}var s="function"==typeof require,r="undefined"!=typeof window,a=s&&r?require("jcc2d/build/jcc2d.light.js"):r?window.JC:{},c={GLOBAL_WEIGHT:.25,MAX_SLOPE:20,TIMELINE:{stars:[.08,.08,.28,.52,.12],blinks:[.3,.05,.15]}},d=new a.Point(0,0,10);i.prototype._center=function(){this.doc.pivotX=this.doc.width>>1,this.doc.pivotY=this.doc.height>>1},i.prototype.fly=function(t){var i=t.start,e=t.end,n=t.wait,o=t.duration;if(!this.alive){var s=this,r=new a.Point(i.x,i.y).add(this.offset),d=new a.Point(e.x,e.y),l=this._findCP(r,d),h=new a.BezierCurve([r,l,d]),u=c.TIMELINE.stars;this.alive=!0,this.doc.runners({runners:[{from:{scale:0,x:r.x,y:r.y},to:{scale:1.2,x:r.x,y:r.y},duration:u[0]*o},{to:{scale:1},duration:u[1]*o},{path:h,wait:u[2]*o,duration:u[3]*o,ease:a.Tween.Back.In},{to:{scale:0},duration:u[4]*o,ease:a.Tween.Linear.None}],wait:n,onCompelete:function(){s.alive=!1}},!0)}},i.prototype._findCP=function(t,i){var e=(new a.Point).addVectors(i,t).divideScalar(2),n=(new a.Point).subVectors(i,t),o=(i.x>t.x?-1:1)*(i.y>t.y?1:-1),s=(new a.Point).crossVectors(d,n).normalize(),r=n.length(),l=0!==n.y?Math.abs(n.x/n.y):c.MAX_SLOPE,h=Math.sqrt(Math.min(c.MAX_SLOPE,Math.abs(l)))*r,u=s.multiplyScalar(o*h*c.GLOBAL_WEIGHT);return e.add(u)},e.prototype.render=function(t){t.beginPath(),t.fillStyle=this.color,t.arc(0,0,this.radius,0,2*Math.PI,!0),t.closePath(),t.fill()},n.prototype.boom=function(t){var i=t.endBase,e=t.end,n=t.wait,o=t.duration;if(!this.alive){var s=this,r=i.x,d=i.y,l=e.x,h=e.y,u=r+l,p=d+h,f=c.TIMELINE.blinks;this.alive=!0,this.doc.runners({runners:[{from:{x:r,y:d,scale:0},to:{x:u,y:p,scale:1},duration:f[0]*o,ease:a.Tween.Linear.None},{to:{x:r+1.1*l,y:d+1.1*h},duration:f[1]*o,ease:a.Tween.Linear.None},{to:{scale:0},duration:f[2]*o,ease:a.Tween.Linear.None}],wait:n,onCompelete:function(){s.alive=!1}},!0)}};var l={merge:function(t,i){if(!i)return t;for(var e in i)void 0!==i[e]&&(t[e]=i[e]);return t}},h=[{x:-8,y:-8},{x:14,y:-2},{x:-5,y:11}],u={aliveCoins:[],idelCoins:[],aliveBlinks:[],idelBlinks:[],criclrPoint:{}},p={dom:"flycoins-stage",interactive:!1,enableFPS:!1,width:320,height:320};o.prototype.init=function(){this.stage=new a.Stage(this.stageOpts),this.coins=new a.Container,this.blinks=new a.Container,this.stage.adds(this.blinks,this.coins)},o.prototype._getTarget=function(t,i){(i<=0||t<=0)&&console.error("you must insure count and range > 0");var e="cp"+t+"N"+i,n=u.criclrPoint[e]=u.criclrPoint[e]||[];if(n.length===t)return n;for(var o=0;o<t;o++){var s=2*Math.PI*o/t,r=new a.Point(Math.cos(s)*i,Math.sin(s)*i);n.push(r)}return n},o.prototype._checkAlive=function(t,i){for(var e=t.length-1;e>=0;e--)t[e].alive||i.push(t.splice(e,1)[0])},o.prototype._shipCoins=function(t){var e=this;this._checkAlive(u.aliveCoins,u.idelCoins);var n=t.offsets||h,o=n.length,s=o-u.idelCoins.length;if(s>0)for(var r=0;r<s;r++)u.idelCoins.push(new i(t));var c=u.idelCoins.splice(0,o);return n.forEach(function(t,i){var n=c[i];n.offset=new a.Point(t.x,t.y),e.coins.adds(n.doc)}),c},o.prototype._emitCoins=function(t,i){var e=i.end,n=i.duration,o=i.start;e=e||this.end,n=n||this.duration;for(var s=t.length-1,r=s;r>=0;r--){var a=t[r];a.fly({start:o,end:e,wait:(s-r)*n*.1,duration:n}),u.aliveCoins.push(a)}},o.prototype.flying=function(t){var i=t.coins,e=t.blinks,n=t.start,o=t.end,s=l.merge(this.coinsOpts,i),r=l.merge(this.blinksOpts,e),a=this._shipCoins(s);this._emitCoins(a,{start:n,end:o}),this._shipAndEmitBlinks(r,o)},o.prototype._shipAndEmitBlinks=function(t,i){var e=t.count,o=t.range,s=t.color,r=t.radius;this._checkAlive(u.aliveBlinks,u.idelBlinks);var a=this._getTarget(e,o),c=e-u.idelBlinks.length;if(c>0)for(var d=0;d<c;d++)u.idelBlinks.push(new n({color:s,radius:r}));var l=u.idelBlinks.splice(0,e);i=i||this.end;for(var h=this.duration,p=l.length,f=0;f<p;f++){var v=l[f],y=a[f];this.blinks.adds(v.doc),v.boom({endBase:i,end:y,wait:h,duration:h}),u.aliveBlinks.push(v)}},o.prototype.start=function(){this.stage.startEngine()},o.prototype.stop=function(){this.stage.stopEngine()},t.JC=a,t.CONFIG=c,t.FlyCoins=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
