{"version":3,"sources":["index.min.js"],"names":["global","factory","exports","module","define","amd","JC","this","Coin","options","_this","texture","Texture","doc","Sprite","scale","pivot","pivotX","x","pivotY","y","loaded","_center","on","Cricle","radius","color","Blink","Graphics","FlyCoins","stageOpts","Utils","merge","STAGE_OPTION","stage","coinsOpts","coins","blinksOpts","blinks","end","duration","init","inModule","require","inBrowser","window","CONFIG","GLOBAL_WEIGHT","MAX_SLOPE","TIMELINE","stars","FRONT","Point","prototype","width","height","fly","_ref","start","wait","alive","This","sp","add","offset","ep","cp","_findCP","path","BezierCurve","timeline","runners","from","to","ease","Tween","Back","In","Linear","None","onCompelete","center","addVectors","divideScalar","direction","subVectors","symbol","perpendicular","crossVectors","normalize","length","rawSlope","Math","abs","weight","sqrt","min","scalar","multiplyScalar","render","ctx","beginPath","fillStyle","arc","PI","closePath","fill","boom","endBase","sx","sy","ex","ey","master","branch","key","undefined","OFFSETS","STORE","aliveCoins","idelCoins","aliveBlinks","idelBlinks","criclrPoint","dom","interactive","enableFPS","Stage","Container","adds","_getTarget","count","range","console","error","mark","target","i","rad","p","cos","sin","push","_checkAlive","idel","splice","_shipCoins","offsets","num","emitCoins","forEach","it","idx","coin","_emitCoins","coinsobj","last","flying","_ref2","cCoins","cBlinks","_shipAndEmitBlinks","_ref3","targetPoints","emitBlinks","_i","blink","startEngine","stop","stopEngine","Object","defineProperty","value"],"mappings":"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","file":"index.min.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.JC = global.JC || {})));\n}(this, (function (exports) { 'use strict';\n\nvar inModule = typeof require === 'function';\nvar inBrowser = typeof window !== 'undefined';\nvar JC = inModule && inBrowser ? require('jcc2d/build/jcc2d.light.js') : inBrowser ? window.JC : {};\n\nvar CONFIG = {\n  GLOBAL_WEIGHT: 0.25,\n  MAX_SLOPE: 20,\n  TIMELINE: {\n    stars: [0.08, 0.08, 0.28, 0.52, 0.12],\n    blinks: [0.3, 0.05, 0.15]\n  }\n};\n\n/* eslint no-bitwise: 0 */\n\nvar FRONT = new JC.Point(0, 0, 10);\n/**\n *\n * @param {Object} options\n */\nfunction Coin(options) {\n  var _this = this;\n\n  var texture = new JC.Texture(options.texture);\n  this.doc = new JC.Sprite({\n    texture: texture\n  });\n  this.doc.scale = 0;\n  if (options.pivot) {\n    this.doc.pivotX = options.pivot.x;\n    this.doc.pivotY = options.pivot.y;\n  } else {\n    if (texture.loaded) {\n      this._center();\n    } else {\n      texture.on('load', function () {\n        _this._center();\n      });\n    }\n  }\n}\n\nCoin.prototype._center = function () {\n  this.doc.pivotX = this.doc.width >> 1;\n  this.doc.pivotY = this.doc.height >> 1;\n};\n\nCoin.prototype.fly = function (_ref) {\n  var start = _ref.start,\n      end = _ref.end,\n      wait = _ref.wait,\n      duration = _ref.duration;\n\n  if (this.alive) return;\n  var This = this;\n  var sp = new JC.Point(start.x, start.y).add(this.offset);\n  var ep = new JC.Point(end.x, end.y);\n  var cp = this._findCP(sp, ep);\n  var path = new JC.BezierCurve([sp, cp, ep]);\n  var timeline = CONFIG.TIMELINE.stars;\n\n  this.alive = true;\n  this.doc.runners({\n    runners: [{\n      from: { scale: 0, x: sp.x, y: sp.y },\n      to: { scale: 1.2, x: sp.x, y: sp.y },\n      duration: timeline[0] * duration\n    }, {\n      to: { scale: 1 },\n      duration: timeline[1] * duration\n    }, {\n      path: path,\n      wait: timeline[2] * duration,\n      duration: timeline[3] * duration,\n      ease: JC.Tween.Back.In\n    }, {\n      to: { scale: 0 },\n      duration: timeline[4] * duration,\n      ease: JC.Tween.Linear.None\n    }],\n    wait: wait,\n    onCompelete: function onCompelete() {\n      This.alive = false;\n    }\n  }, true);\n};\n\nCoin.prototype._findCP = function (sp, ep) {\n  var center = new JC.Point().addVectors(ep, sp).divideScalar(2);\n  var direction = new JC.Point().subVectors(ep, sp);\n  var symbolX = ep.x > sp.x ? -1 : 1;\n  var symbolY = ep.y > sp.y ? 1 : -1;\n  var symbol = symbolX * symbolY;\n  var perpendicular = new JC.Point().crossVectors(FRONT, direction).normalize();\n\n  var length = direction.length();\n  var rawSlope = direction.y !== 0 ? Math.abs(direction.x / direction.y) : CONFIG.MAX_SLOPE;\n  var slope = Math.sqrt(Math.min(CONFIG.MAX_SLOPE, Math.abs(rawSlope)));\n  var weight = slope * length;\n\n  var scalar = perpendicular.multiplyScalar(symbol * weight * CONFIG.GLOBAL_WEIGHT);\n\n  return center.add(scalar);\n};\n\n/**\n *\n * @param {Object} options\n */\nfunction Cricle(options) {\n  options = options || {};\n  this.radius = options.radius || 8;\n  this.color = options.color || '#FFD44F';\n}\n\nCricle.prototype.render = function (ctx) {\n  ctx.beginPath();\n  ctx.fillStyle = this.color;\n  ctx.arc(0, 0, this.radius, 0, Math.PI * 2, true);\n  ctx.closePath();\n  ctx.fill();\n};\n\n/**\n *\n * @param {Object} options\n */\nfunction Blink(options) {\n  options = options || {};\n  this.doc = new JC.Graphics(new Cricle({\n    radius: options.radius,\n    color: options.color\n  }));\n  this.doc.scale = 0;\n}\n\nBlink.prototype.boom = function (_ref) {\n  var endBase = _ref.endBase,\n      end = _ref.end,\n      wait = _ref.wait,\n      duration = _ref.duration;\n\n  if (this.alive) return;\n  var This = this;\n  var sx = endBase.x;\n  var sy = endBase.y;\n  var x = end.x;\n  var y = end.y;\n  var ex = sx + x;\n  var ey = sy + y;\n  var timeline = CONFIG.TIMELINE.blinks;\n\n  this.alive = true;\n  this.doc.runners({\n    runners: [{\n      from: { x: sx, y: sy, scale: 0 },\n      to: { x: ex, y: ey, scale: 1 },\n      duration: timeline[0] * duration,\n      ease: JC.Tween.Linear.None\n    }, {\n      to: { x: sx + x * 1.1, y: sy + y * 1.1 },\n      duration: timeline[1] * duration,\n      ease: JC.Tween.Linear.None\n    }, {\n      to: { scale: 0 },\n      duration: timeline[2] * duration,\n      ease: JC.Tween.Linear.None\n    }],\n    wait: wait,\n    onCompelete: function onCompelete() {\n      This.alive = false;\n    }\n  }, true);\n};\n\n/**\n * Utils 工具箱\n *\n * @namespace JC.Utils\n */\nvar Utils = {\n  merge: function merge(master, branch) {\n    if (!branch) return master;\n    for (var key in branch) {\n      if (branch[key] !== undefined) {\n        master[key] = branch[key];\n      }\n    }\n    return master;\n  }\n};\n\nvar PMARK = 'cp';\nvar OFFSETS = [{ x: -8, y: -8 }, { x: 14, y: -2 }, { x: -5, y: 11 }];\nvar STORE = {\n  aliveCoins: [],\n  idelCoins: [],\n  aliveBlinks: [],\n  idelBlinks: [],\n  criclrPoint: {}\n};\nvar STAGE_OPTION = {\n  dom: 'flycoins-stage',\n  interactive: false,\n  enableFPS: false,\n  width: 320,\n  height: 320\n};\n\n/**\n *\n * @param {Object} options 配置\n */\nfunction FlyCoins(options) {\n  options = options || {};\n  this.stageOpts = Utils.merge(STAGE_OPTION, options.stage);\n  this.coinsOpts = options.coins || {};\n  this.blinksOpts = options.blinks || {};\n  this.end = options.end || {};\n  this.duration = options.duration || 1000;\n  this.init();\n}\n\nFlyCoins.prototype.init = function () {\n  this.stage = new JC.Stage(this.stageOpts);\n  this.coins = new JC.Container();\n  this.blinks = new JC.Container();\n  this.stage.adds(this.blinks, this.coins);\n};\n\nFlyCoins.prototype._getTarget = function (count, range) {\n  if (range <= 0 || count <= 0) {\n    console.error('you must insure count and range > 0');\n  }\n  var mark = PMARK + count + 'N' + range;\n  var target = STORE.criclrPoint[mark] = STORE.criclrPoint[mark] || [];\n  if (target.length === count) return target;\n  for (var i = 0; i < count; i++) {\n    var rad = Math.PI * 2 * i / count;\n    var p = new JC.Point(Math.cos(rad) * range, Math.sin(rad) * range);\n    target.push(p);\n  }\n  return target;\n};\n\nFlyCoins.prototype._checkAlive = function (alive, idel) {\n  for (var i = alive.length - 1; i >= 0; i--) {\n    var coin = alive[i];\n    if (!coin.alive) {\n      idel.push(alive.splice(i, 1)[0]);\n    }\n  }\n};\n\nFlyCoins.prototype._shipCoins = function (coins) {\n  var _this = this;\n\n  this._checkAlive(STORE.aliveCoins, STORE.idelCoins);\n  var offsets = coins.offsets || OFFSETS;\n  var count = offsets.length;\n  var num = count - STORE.idelCoins.length;\n  if (num > 0) {\n    for (var i = 0; i < num; i++) {\n      STORE.idelCoins.push(new Coin(coins));\n    }\n  }\n  var emitCoins = STORE.idelCoins.splice(0, count);\n  offsets.forEach(function (it, idx) {\n    var coin = emitCoins[idx];\n    coin.offset = new JC.Point(it.x, it.y);\n    _this.coins.adds(coin.doc);\n  });\n  return emitCoins;\n};\n\nFlyCoins.prototype._emitCoins = function (coinsobj, _ref) {\n  var end = _ref.end,\n      duration = _ref.duration,\n      start = _ref.start;\n\n  end = end || this.end;\n  duration = duration || this.duration;\n  var last = coinsobj.length - 1;\n  for (var i = last; i >= 0; i--) {\n    var coin = coinsobj[i];\n    coin.fly({\n      start: start,\n      end: end,\n      wait: (last - i) * duration * 0.1,\n      duration: duration\n    });\n    STORE.aliveCoins.push(coin);\n  }\n};\n\nFlyCoins.prototype.flying = function (_ref2) {\n  var coins = _ref2.coins,\n      blinks = _ref2.blinks,\n      start = _ref2.start,\n      end = _ref2.end;\n\n  var cCoins = Utils.merge(this.coinsOpts, coins);\n  var cBlinks = Utils.merge(this.blinksOpts, blinks);\n\n  var coinsobj = this._shipCoins(cCoins);\n  this._emitCoins(coinsobj, {\n    start: start,\n    end: end\n  });\n\n  this._shipAndEmitBlinks(cBlinks, end);\n};\n\nFlyCoins.prototype._shipAndEmitBlinks = function (_ref3, endBase) {\n  var count = _ref3.count,\n      range = _ref3.range,\n      color = _ref3.color,\n      radius = _ref3.radius;\n\n  this._checkAlive(STORE.aliveBlinks, STORE.idelBlinks);\n\n  var targetPoints = this._getTarget(count, range);\n\n  var num = count - STORE.idelBlinks.length;\n  if (num > 0) {\n    for (var i = 0; i < num; i++) {\n      STORE.idelBlinks.push(new Blink({\n        color: color,\n        radius: radius\n      }));\n    }\n  }\n  var emitBlinks = STORE.idelBlinks.splice(0, count);\n  // TODO: add update blink color and radius\n\n  endBase = endBase || this.end;\n  var duration = this.duration;\n  var length = emitBlinks.length;\n  for (var _i = 0; _i < length; _i++) {\n    var blink = emitBlinks[_i];\n    var end = targetPoints[_i];\n    this.blinks.adds(blink.doc);\n    blink.boom({\n      endBase: endBase,\n      end: end,\n      wait: duration,\n      duration: duration\n    });\n    STORE.aliveBlinks.push(blink);\n  }\n};\n\nFlyCoins.prototype.start = function () {\n  this.stage.startEngine();\n};\n\nFlyCoins.prototype.stop = function () {\n  this.stage.stopEngine();\n};\n\nexports.JC = JC;\nexports.CONFIG = CONFIG;\nexports.FlyCoins = FlyCoins;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=index.js.map\n"]}